<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ورود با OTP</title>
  <style>
    body {
      font-family: 'Vazir', sans-serif;
      background-color: #e6f5e6; /* سبز خیلی ملایم */
      color: #2e4d2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 80px;
    }

    h2 {
      color: #d00000;
      margin-bottom: 30px;
    }

    input {
      padding: 12px;
      margin: 10px;
      font-size: 16px;
      width: 280px;
      border: 2px solid #d00000;
      border-radius: 6px;
      background-color: #ffffff;
      color: #2e4d2e;
      box-shadow: 0 0 5px rgba(208, 0, 0, 0.2);
    }

    input::placeholder {
      color: #999;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      background-color: #d00000;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #a00000;
    }

    #message {
      margin-top: 20px;
      font-size: 16px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h2>ورود با شماره موبایل و OTP</h2>

  <input type="text" id="phone" placeholder="شماره موبایل را وارد کنید">
  <button onclick="sendOTP()">ارسال کد تأیید</button>

  <input type="text" id="otp" placeholder="کد تأیید را وارد کنید">
  <button onclick="verifyOTP()">تأیید کد و ورود</button>

  <div id="message"></div>

  <script>
    async function sendOTP() {
      const phone = document.getElementById("phone").value.trim();
      const messageDiv = document.getElementById("message");

      if (!/^09\d{9}$/.test(phone)) {
        messageDiv.style.color = "#d00000";
        messageDiv.textContent = "شماره موبایل معتبر نیست.";
        return;
      }

      try {
        const response = await fetch("/send-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone })
        });

        const data = await response.json();
        if (response.ok) {
          messageDiv.style.color = "#2e7d32";
          messageDiv.textContent = data.message || "کد تأیید ارسال شد!";
        } else {
          messageDiv.style.color = "#d00000";
          messageDiv.textContent = data.message || "ارسال کد ناموفق بود.";
        }
      } catch (err) {
        messageDiv.style.color = "#d00000";
        messageDiv.textContent = "خطا در اتصال به سرور.";
        console.error("❌ Fetch error:", err);
      }
    }

    async function verifyOTP() {
      const phone = document.getElementById("phone").value.trim();
      const otp = document.getElementById("otp").value.trim();
      const messageDiv = document.getElementById("message");

      if (!/^09\d{9}$/.test(phone) || otp.length !== 6) {
        messageDiv.style.color = "#d00000";
        messageDiv.textContent = "شماره یا کد تأیید نامعتبر است.";
        return;
      }

      try {
        const response = await fetch("/verify-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone, otp })
        });

        const data = await response.json();
        if (response.ok && data.valid) {
          messageDiv.style.color = "#2e7d32";
          messageDiv.textContent = data.message || "✅ ورود با موفقیت انجام شد!";
          setTimeout(() => {
            window.location.href = "description.html";
          }, 1000); // انتقال بعد از ۱ ثانیه
        } else {
          messageDiv.style.color = "#d00000";
          messageDiv.textContent = data.message || "❌ کد تأیید اشتباه است.";
        }
      } catch (err) {
        messageDiv.style.color = "#d00000";
        messageDiv.textContent = "خطا در اتصال به سرور.";
        console.error("❌ Fetch error:", err);
      }
    }
  </script>

</body>
</html>
